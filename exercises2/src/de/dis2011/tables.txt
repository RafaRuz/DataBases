DROP TABLE ESTATEAGENT;
CREATE TABLE ESTATEAGENT(
    /*id INTEGER NOT NULL GENERATED ALWAYS AS IDENTITY (START WITH 1, INCREMENT BY 1, NO CACHE) PRIMARY KEY,*/
    name VARCHAR(255),
    address VARCHAR(255),
    login VARCHAR(40)  NOT NULL UNIQUE PRIMARY KEY,
    password VARCHAR(40)
);


DROP TABLE ESTATE;
CREATE TABLE ESTATE(
    id INTEGER NOT NULL GENERATED ALWAYS AS IDENTITY (START WITH 1, INCREMENT BY 1, NO CACHE) PRIMARY KEY,
    city VARCHAR(255),
    postal_code INTEGER,
    street VARCHAR(255),
    street_number INTEGER,
    square_area INTEGER,
    manager VARCHAR(40) NOT NULL,
    FOREIGN KEY(manager) REFERENCES EstateAgent(login) ON DELETE CASCADE
);


DROP TABLE HOUSE;
CREATE TABLE HOUSE(
    id INTEGER NOT NULL PRIMARY KEY,
    floors INTEGER,
    price INTEGER,
    garden SMALLINT,
    FOREIGN KEY(id) REFERENCES Estate(id) ON DELETE CASCADE
);


DROP TABLE APARTMENT;
CREATE TABLE APARTMENT(
    id INTEGER NOT NULL PRIMARY KEY,
    floor INTEGER,
    rent INTEGER,
    rooms INTEGER,
    balcony SMALLINT,
    kitchen SMALLINT,
    FOREIGN KEY(id) REFERENCES Estate(id) ON DELETE CASCADE
);


DROP TABLE PERSON;
CREATE TABLE PERSON(
    id INTEGER NOT NULL GENERATED ALWAYS AS IDENTITY (START WITH 1, INCREMENT BY 1, NO CACHE) PRIMARY KEY,
    first_name VARCHAR(255),
    name VARCHAR(255),
    address VARCHAR(255)
);

DROP TABLE CONTRACT;
CREATE TABLE CONTRACT(
    id INTEGER NOT NULL GENERATED ALWAYS AS IDENTITY (START WITH 1, INCREMENT BY 1, NO CACHE) PRIMARY KEY ,
    date DATE,
    place VARCHAR(255),
    person_id INTEGER NOT NULL,
    estate_id INTEGER UNIQUE NOT NULL,
    FOREIGN KEY(person_id) REFERENCES Person(id) ON DELETE CASCADE,
    FOREIGN KEY(estate_id) REFERENCES Estate(id) ON DELETE CASCADE
);


DROP TABLE PURCHASECONTRACT;
CREATE TABLE PURCHASECONTRACT(
    id INTEGER NOT NULL GENERATED ALWAYS AS IDENTITY (START WITH 1, INCREMENT BY 1, NO CACHE) PRIMARY KEY,
    installments INTEGER,
    interest INTEGER,
    person_id INTEGER NOT NULL,
    house_id INTEGER UNIQUE NOT NULL,
    FOREIGN KEY(id) REFERENCES Contract(id) ON DELETE CASCADE,
    FOREIGN KEY(person_id) REFERENCES Person(id) ON DELETE CASCADE,
    FOREIGN KEY(house_id) REFERENCES House(id) ON DELETE CASCADE
);


DROP TABLE TENANCYCONTRACT;
CREATE TABLE TENANCYCONTRACT(
    id INTEGER NOT NULL GENERATED ALWAYS AS IDENTITY (START WITH 1, INCREMENT BY 1, NO CACHE) PRIMARY KEY,
    start_date DATE,
    duration INTEGER,
    additional_costs INTEGER,
    person_id INTEGER NOT NULL,
    apartment_id INTEGER UNIQUE NOT NULL,
    FOREIGN KEY(id) REFERENCES Contract(id) ON DELETE CASCADE,
    FOREIGN KEY(person_id) REFERENCES Person(id) ON DELETE CASCADE,
    FOREIGN KEY(apartment_id) REFERENCES Apartment(id) ON DELETE CASCADE
);
